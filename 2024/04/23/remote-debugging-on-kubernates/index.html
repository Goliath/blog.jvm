<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Bitecode blog"><meta property="og:type" content="article"><meta property="og:image" content="https://bitecode.blog//img/bg_water.webp"><meta property="twitter:image" content="https://bitecode.blog//img/bg_water.webp"><meta name=title content="Remote JVM debugging"><meta property="og:title" content="Remote JVM debugging"><meta property="twitter:title" content="Remote JVM debugging"><meta name=description content="Sometimes the best place to troubleshot an issue is the remote instance."><meta property="og:description" content="Sometimes the best place to troubleshot an issue is the remote instance."><meta property="twitter:description" content="Sometimes the best place to troubleshot an issue is the remote instance."><meta property="twitter:card" content="summary"><meta name=keyword content="JVM, java, openjdk, jdk, performance, profiling, debugging, speed, bytecode, software craftsmanship, design patterns, java speed, security"><link rel="shortcut icon" href=/img/favicon.ico><title>Remote JVM debugging | Marcin Szlagor's blog on JVM technologies</title>
<link rel=canonical href=/2024/04/23/remote-debugging-on-kubernates/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>Bitecode blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/groovy/>groovy</a></li><li><a href=/categories/jvm/>jvm</a></li><li><a href=/categories/performance/>performance</a></li><li><a href=/categories/security/>security</a></li><li><a href=/categories/tips/>tips</a></li><li><a href=/about/>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/bg_water.webp)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/jvm title=JVM>JVM
</a><a class=tag href=/tags/debugging title=Debugging>Debugging
</a><a class=tag href=/tags/kubernetes title=kubernetes>kubernetes
</a><a class=tag href=/tags/devops title=DevOps>DevOps</a></div><h1>Remote JVM debugging</h1><h2 class=subheading></h2><span class=meta>Posted by
Marcin
on
Tuesday, April 23, 2024</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h2 id=scenario>Scenario</h2><p>Debugging applications in a local environment is straightforward, but what happens when your application is running in a Kubernetes cluster?
Sometimes the best place to debug an issue is the remote instance itself.
This article will guide you through the process of remotely debugging your Java applications running in Kubernetes.</p><h2 id=prerequisites>Prerequisites</h2><p>In this very short post I assume you have:</p><ul><li>a Java application running in a Kubernetes cluster</li><li>IntelliJ IDEA</li><li>kubectl command-line tool installed and configured</li></ul><h2 id=step-1-start-your-java-application-in-debug-mode>Step 1: Start Your Java Application in Debug Mode</h2><p>First, you need to ensure your Java application is running in debug mode. This is not happening by default.</p><p>Please adjust your application startup command by adding the following JVM options:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-agentlib:jdwp<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>transport</span><span style=color:#ff79c6>=</span>dt_socket,server<span style=color:#ff79c6>=</span>y,suspend<span style=color:#ff79c6>=</span>n,address<span style=color:#ff79c6>=</span>*:5005
</span></span></code></pre></div><p>This will start your Java application in debug mode, listening on port 5005.</p><p>Let&rsquo;s shortly explain what some of the options mean:</p><ul><li>server=y stands for the server mode, which means that the JVM will listen for incoming debugger connections.</li><li>suspend=n means that the JVM will not wait for the debugger to connect before starting the application. This could be useful when you want to debug the application from the very beginning.</li><li>address=*:5005 specifies host and port on which the JVM will listen for incoming debugger connections.</li></ul><h2 id=step-2-expose-debug-port-in-kubernetes>Step 2: Expose Debug Port in Kubernetes</h2><h3 id=expose-debug-port-in-kubernetes-deployment>Expose Debug Port in Kubernetes deployment</h3><p>That can be achieved by either modifying the deployment file or using kubectl port-forward command.</p><p>Below k8s deployment snippet shows how deployment could be adjusted in order to open debug port:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: my-java-app
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>image</span>: my-java-app:latest
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>8080</span>
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: debug
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>5005</span>
</span></span></code></pre></div><h3 id=tunnel-the-debug-port-to-your-local-machine>Tunnel the Debug Port to Your Local Machine</h3><p>On the other hand we can port forward the debug port to our local machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward deployment/my-java-app 5005:5005
</span></span></code></pre></div><h2 id=step-3-connect-intellij-idea-to-the-remote-jvm>Step 3: Connect IntelliJ IDEA to the Remote JVM</h2><p>I&rsquo;m personally a big fan of IntelliJ IDEA, so I will guide you through the process of connecting to the remote JVM using IntelliJ IDEA.</p><ol><li><p>Go to Run -> Edit Configurations.</p></li><li><p>Click on the + button and select Remote.</p></li><li><p>In the Port field, enter 5005.</p></li><li><p>Click OK.</p></li><li><p>Now, you can start your debugging session by clicking on the debug icon or by pressing Shift + F9.</p></li></ol><h2 id=conclusion>Conclusion</h2><p>Debugging Java applications in Kubernetes might seem daunting at first, but with the right tools and configurations, it becomes a straightforward task. Happy troubleshooting! Just let me know what you think about this article in the comments.</p><style type=text/css>.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media(prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>Few things to note from security perspective:</p><ul><li>as of writing this article intelliJ does not support authentication of the debugging connection!</li><li>because of above I prefer that debug socket listens only on localhost address (address=localhost:5005) and then use kubectl port-forward to tunnel the connection only to debug client machine</li><li>I would also recommend to change the default debug port to something less obvious (address=localhost:PORT)</li></ul></div><div class="notice tip"><p class=notice-title><span class="icon-notice baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="300.5 134 300 300"><path d="M551.281 252.36c0-3.32-1.172-6.641-3.515-8.985l-17.774-17.578c-2.344-2.344-5.469-3.711-8.789-3.711-3.32.0-6.445 1.367-8.789 3.71l-79.687 79.493-44.141-44.14c-2.344-2.344-5.469-3.712-8.79-3.712-3.32.0-6.444 1.368-8.788 3.711l-17.774 17.579c-2.343 2.343-3.515 5.664-3.515 8.984s1.172 6.445 3.515 8.789l70.704 70.703c2.343 2.344 5.664 3.711 8.789 3.711 3.32.0 6.64-1.367 8.984-3.71l106.055-106.056c2.343-2.343 3.515-5.468 3.515-8.789zM600.5 284c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg>
</span>Tip</p><p>Would I recommend to have debugging enabled by default on:</p><ul><li>production? No, I would not.</li><li>staging? Yes. Just make sure that you have a way to secure the connection.</li></ul></div><hr><ul class=pager><li class=previous><a href=/2024/04/20/java-ergonomics-basics/ data-toggle=tooltip data-placement=top title="Introduction to Java ergonomics">&larr;
Previous Post</a></li><li class=next><a href=/2024/05/10/tweaking-stack-for-fun-and-profit/ data-toggle=tooltip data-placement=top title="Tweaking the stack for fun and profit">Next
Post &rarr;</a></li></ul><div id=disqus-comment></div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bitecode-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:marcin.szlagor@codeappeal.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/Goliath><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/marcinszlagor/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Bitecode blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Bitecode blog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>